<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Báo cáo chi tiêu</title>
  <style>
    body {
      font-family: 'DejaVu Sans', Arial, sans-serif;
      font-size: 12px;
      line-height: 1.4;
      color: #333;
      margin: 0;
      padding: 20px;
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
      border-bottom: 2px solid #2563eb;
      padding-bottom: 20px;
    }

    .header h1 {
      color: #2563eb;
      font-size: 24px;
      margin: 0 0 10px 0;
    }

    .header .period {
      font-size: 14px;
      color: #666;
    }

    .summary-section {
      margin-bottom: 30px;
    }

    .summary-grid {
      display: table;
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }

    .summary-item {
      display: table-cell;
      width: 25%;
      text-align: center;
      padding: 15px;
      border: 1px solid #e5e7eb;
      background-color: #f9fafb;
    }

    .summary-item .label {
      font-size: 11px;
      color: #666;
      margin-bottom: 5px;
    }

    .summary-item .value {
      font-size: 16px;
      font-weight: bold;
      color: #2563eb;
    }

    .section-title {
      font-size: 16px;
      font-weight: bold;
      color: #2563eb;
      margin: 25px 0 15px 0;
      padding-bottom: 5px;
      border-bottom: 1px solid #e5e7eb;
    }

    .expenses-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }

    .expenses-table th {
      background-color: #f3f4f6;
      padding: 10px;
      text-align: left;
      font-weight: bold;
      border: 1px solid #d1d5db;
      font-size: 11px;
    }

    .expenses-table td {
      padding: 8px 10px;
      border: 1px solid #d1d5db;
      font-size: 11px;
    }

    .expenses-table tr:nth-child(even) {
      background-color: #f9fafb;
    }

    .category-breakdown {
      margin-bottom: 20px;
    }

    .category-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid #e5e7eb;
    }

    .category-item:last-child {
      border-bottom: none;
    }

    .category-name {
      font-weight: bold;
    }

    .category-amount {
      text-align: right;
    }

    .footer {
      margin-top: 30px;
      text-align: center;
      font-size: 10px;
      color: #666;
      border-top: 1px solid #e5e7eb;
      padding-top: 15px;
    }

    .currency {
      font-family: 'DejaVu Sans Mono', monospace;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>Báo cáo chi tiêu</h1>
    <div class="period">Từ <%= @start_date.strftime('%d/%m/%Y') %> đến <%= @end_date.strftime('%d/%m/%Y') %></div>
  </div>

  <div class="summary-section">
    <div class="summary-grid">
      <div class="summary-item">
        <div class="label">Tổng chi tiêu</div>
        <div class="value currency"><%= number_to_currency(@total_expenses, unit: "₫", precision: 0) %></div>
      </div>
      <div class="summary-item">
        <div class="label">Số danh mục</div>
        <div class="value"><%= @expenses_by_category.count %></div>
      </div>
      <div class="summary-item">
        <div class="label">Số ngày</div>
        <div class="value"><%= (@end_date - @start_date).to_i + 1 %></div>
      </div>
      <div class="summary-item">
        <div class="label">TB/ngày</div>
        <div class="value currency"><%= number_to_currency(@total_expenses / [(@end_date - @start_date).to_i + 1, 1].max, unit: "₫", precision: 0) %></div>
      </div>
    </div>
  </div>

  <div class="section-title">Chi tiêu theo danh mục</div>
  <div class="category-breakdown">
    <% if @expenses_by_category.any? %>
      <% @expenses_by_category.each do |category, amount| %>
        <div class="category-item">
          <div class="category-name">
            <span style="color: <%= category.color %>">●</span>
            <%= category.name %>
          </div>
          <div class="category-amount">
            <div class="currency"><%= number_to_currency(amount, unit: "₫", precision: 0) %></div>
            <div style="font-size: 10px; color: #666;">
              <%= number_to_percentage(amount / @total_expenses * 100, precision: 1) %>
            </div>
          </div>
        </div>
      <% end %>
    <% else %>
      <p style="text-align: center; color: #666; font-style: italic;">Không có chi tiêu trong khoảng thời gian này</p>
    <% end %>
  </div>

  <div class="section-title">Chi tiết từng khoản chi</div>
  <% if @expenses.any? %>
    <table class="expenses-table">
      <thead>
        <tr>
          <th>Ngày</th>
          <th>Danh mục</th>
          <th>Mô tả</th>
          <th style="text-align: right;">Số tiền</th>
        </tr>
      </thead>
      <tbody>
        <% @expenses.each do |expense| %>
          <tr>
            <td><%= expense.spent_on.strftime('%d/%m/%Y') %></td>
            <td>
              <% if expense.category %>
                <span style="color: <%= expense.category.color %>">●</span>
                <%= expense.category.name %>
              <% else %>
                <span style="color: #999;">Không phân loại</span>
              <% end %>
            </td>
            <td><%= expense.title %></td>
            <td style="text-align: right;" class="currency"><%= number_to_currency(expense.amount, unit: "₫", precision: 0) %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  <% else %>
    <p style="text-align: center; color: #666; font-style: italic;">Không có chi tiêu trong khoảng thời gian này</p>
  <% end %>

  <div class="footer">
    <p>Báo cáo được tạo tự động vào <%= Time.current.strftime('%H:%M:%S ngày %d/%m/%Y') %></p>
    <p>Expense Tracker - Hệ thống quản lý chi tiêu</p>
  </div>
</body>
</html>
